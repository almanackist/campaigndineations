<!DOCTYPE html>

<html>
	<head>
		<title>campaign donEATions</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script src="http://d3js.org/d3.v2.js" type="text/javascript" charset="utf-8"></script>			

	</head>
	
	<style type="text/css">
		body {
			font-family: sans-serif;
			width: 800px;
			margin: 0 auto;
			padding: 10px;
		}
		
		.error {
			color: red
		}
		
		h2 {
			margin-top: 20px;
			margin-bottom: 2px;
		}
		
		h3 {
			margin-top: 5px;
			margin-bottom: 2px;
		}
		
		img {
			margin-top: 5px;
		}
		
		label {
			font-size: 15px;
		}
		
		
		input[type=text] {
			width: 400px;
			font-size: 20px;
			padding: 2px;
		}
		
		textarea {
			width: 400px;
			height: 200px;
			font-size: 17px;
			font-family: monospace;
		}
				
		input[type=submit] {
			font-size: 24px;
		}
		
		hr {
			margin: 20px auto;
		}
		
		.map {
			margin-top: 5px;
			-moz-border-radius: 7px;
			-webkit-border-radius: 7px;
			border-radius: 7px;
		} 

		.art + .art {
			margin-top: 20px;
		}
		
		.art-title {
			font-weight: bold;
			font-size: 20px;
		}
		
		.art-body {
			margin: 0;
			font-size: 17px;
		}
		
		.art-created {
			font-weight: italic;
			font-size: 10px;
		}
		
		.footnote {
			font-size: 10px;
		}
		
		.list-head {
			font-weight: bold;
		}
		
		.list-cell {
			padding: 15px;
		}
		
	</style>
	
	
	<body>
	 <h1>campaign donEATions</h1>

		<div class="intro-text">In a given state, which ZIP code gave the most to a given political candidate? <p>And more importantly: what's the restaurant scene there?</div>
		<div class="footnote">(Campaign contribution data from the Sunlight Foundation's TransparencyData API, for Q4 2011 and slightly into Q1 2012, the most recent period for which 
		I could retrieve and analyze individual contributions. Restaurant information via Factual's place and US restaurants APIs.)</div>

	<hr>

	 <form method = "post">
	 		<label for="state">Show ZIPs in </div><select name="state">
	 			{% for s in [['Alabama', 'AL'], ['Alaska', 'AK'], ['Arizona', 'AZ'], ['Arkansas', 'AR'], ['California', 'CA'], ['Colorado', 'CO'], ['Connecticut', 'CT'], ['Delaware', 'DE'], ['Florida', 'FL'], ['Georgia', 'GA'], ['Hawaii', 'HI'], ['Idaho', 'ID'], ['Illinois', 'IL'], ['Indiana', 'IN'], ['Iowa', 'IA'], ['Kansas', 'KS'], ['Kentucky', 'KY'], ['Louisiana', 'LA'], ['Maine', 'ME'], ['Maryland', 'MD'], ['Massachusetts', 'MA'], ['Michigan', 'MI'], ['Minnesota', 'MN'], ['Mississippi', 'MS'], ['Missouri', 'MO'], ['Montana', 'MT'], ['Nebraska', 'NE'], ['Nevada', 'NV'], ['New Hampshire', 'NH'], ['New Jersey', 'NJ'], ['New Mexico', 'NM'], ['New York', 'NY'], ['North Carolina', 'NC'], ['North Dakota', 'ND'], ['Ohio', 'OH'], ['Oklahoma', 'OK'], ['Oregon', 'OR'], ['Pennsylvania', 'PA'], ['Rhode Island', 'RI'], ['South Carolina', 'SC'], ['South Dakota', 'SD'], ['Tennessee', 'TN'], ['Texas', 'TX'], ['Utah', 'UT'], ['Vermont', 'VT'], ['Virginia', 'VA'], ['Washington', 'WA'], ['West Virginia', 'WV'], ['Wisconsin', 'WI'], ['Wyoming', 'WY']] %}
					{% if s == state %}
						<option value="{{s[1]}}" selected="selected">{{s[0]}}</option>
					{% else %}
						<option value="{{s[1]}}">{{s[0]}}</option>
					{% endif %}
				{% endfor %}
	 		</select>
	 		
	 		
	 		<label for="candidate"> that gave the most to </label><select name="candidate">
	 			{% for name in ['Mitt Romney', 'Barack Obama'] %}
					{% if name == candidate %}
	 					<option value="{{name}}" selected="selected">{{name}}</option>
	 				{% else %}
	 					<option value="{{name}}">{{name}}</option>
	 				{% endif %}
	 			{% endfor %}
	 		</select>
	
	 	
	 		

	 	<input type="submit">
	 
	 	<div class="error">{{error}}</div>
	 	
	 
	 </form>
	 
	 {% if top_zips %}
	 	{% for z in range(0,3) %}
	 	<h2>{{ top_zips[z][0] }}</h2>
	 	<h3>{{ top_zips[z][1][0] }} contributions totalling ${{ top_zips[z][1][1] }}</h3>
	 	<table>
	 	<tr class="footnote" >
	 		<td>
		 	<img class="map" src = '{{ img_urls[z] }}'>
		 	</td>
		 	
		 	<td class = "{{ tables[z] }}">
	 		</td>
	 	</tr>
	 	</table>
	 	{% endfor %}
	 {% endif %}	
	 	
	 	
	 	<script type="text/javascript">

		var data = {{ rest_data|safe }};                        //Initialize empty array
		var tables = ['.table0', '.table1', '.table2']
		
		for (n=0;n<3;n++){

			var data_sub = data[n]
			
			svg1 = d3.select(tables[n]).append("svg");
			
			var h = 140
			var w = 400
			var bar_padding = 2
			
			svg1.attr("width", w)
				.attr("height", h);


			svg1.selectAll("rect")
				.data(data_sub)
				.enter()
				.append("rect")
				.attr("x", 0)
				.attr("y", function(d, i) {
					return i * (h / 6);
				})
				.attr("width", 0)
				.attr("height", h / 6 - bar_padding)
				.attr("fill", "#C6DBEF")
				.transition().duration(1400).attr("width", function(d){
					return d[1]*10;
				});
				
			svg1.selectAll("text")
				.data(data_sub)
				.enter()
				.append("text")
				.text(function(d){
					return d[0];
				})
				.attr("x", 4)
				.attr("y", function(d, i) {
					return i * (h / 6) + 19;
				})
				.attr("font-family", "Helvetica")
				.attr("fill", "#6BAED6")
				.attr("font-size", 19);
				
		};		
        </script>
	 	 	
	 
	</body>
</html>